FROM python:3

ENV PYTHONDONTWRITEBYTECODE=1
ENV PYTHONUNBUFFERED=1

RUN apt-get update -y && apt-get install -y postgresql-client

WORKDIR /code/project/

COPY requirements.txt .
COPY wait.sh /tmp

RUN chmod +x /tmp/wait.sh

RUN apt-get update && \
    apt-get install -y postgresql-client && \
    pip install --no-cache-dir -r requirements.txt

EXPOSE 8000

HEALTHCHECK --start-period=1m --interval=100s \
    CMD curl -f "http://"$SERVER_NAME":8000/admin/" || exit 1

ENTRYPOINT [ "sh", "/tmp/wait.sh" ]
